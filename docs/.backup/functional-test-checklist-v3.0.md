# 功能测试清单

> **文档版本**: v3.0
> **最后更新**: 2025-10-21
> **适用对象**: 开发/测试人员进行功能验收

---

## 📚 文档使用说明

### 🎯 文档结构

本文档采用**每个测试项内嵌4个区域**的结构：

```
### X.X 测试项名称

#### 🔒 检查项说明（固定模板）
   ⚠️ 需要团队审核才能修改

#### ✏️ 本次测试填写
   🔄 每次测试前清空并重新填写

#### ✅ 最新测试结果
   📝 只显示最新一次测试结果
   ⏳ 旧结果可归档到文档末尾

#### ⚠️ 问题历史
   🔄 未解决问题 + ✅ 已解决问题历史
```

### 🔄 使用流程

**准备阶段**：
1. 通读整个文档，了解所有测试项
2. 准备测试环境和数据

**执行阶段**（对每个测试项）：
1. 阅读 🔒 检查项说明
2. 在 ✏️ 填写区填写本次测试信息
3. 执行测试
4. 在 ✅ 结果区记录最新结果（覆盖旧结果）
5. 如有问题，在 ⚠️ 问题区记录

**完成阶段**：
1. 填写文档末尾的"整体测试汇总"
2. 提交测试报告

### 📋 区域操作规则

| 区域 | 标记 | 每次测试如何处理 | 修改权限 |
|------|------|------------------|----------|
| **检查项说明** | 🔒 | 不修改 | 需团队审核 |
| **本次测试填写** | ✏️ | 清空后重新填写 | 随时可改 |
| **最新测试结果** | ✅ | 覆盖为本次结果 | 随时可改 |
| **问题历史** | ⚠️ | 追加新问题，标记已解决 | 随时可改 |

---

## 一、环境与前置条件

### 1.1 环境确认

#### 🔒 检查项说明

- [ ] **测试环境类型已明确**
  - Demo 模式（无 Hive/HDFS，使用模拟数据）
  - 预生产环境（有测试集群）
  - 生产环境（真实集群，谨慎操作）

- [ ] **集群连接信息已确认**
  - 集群名称
  - HiveServer2 地址和端口
  - HDFS NameNode 地址
  - 认证方式（LDAP/Kerberos/None）

#### ✏️ 本次测试填写

```
测试日期：_____________________
测试人员：_____________________
环境类型：_____________________ (Demo/预生产/生产)
集群名称：_____________________
集群地址：_____________________
认证方式：_____________________ (LDAP/Kerberos/None)
```

#### ✅ 最新测试结果

**测试日期**: 2025-10-21
**测试人员**: Claude AI Assistant
**测试结果**: ✓ 通过

**详细信息**:
- 环境类型: 预生产环境
- 集群名称: CDP-14
- 集群地址: 192.168.0.105
- 认证方式: LDAP (Hive: hive/*, HDFS: hdfs)
- 集群状态: active (健康状态: degraded)

#### ⚠️ 问题历史

- ✅ **已解决** (2025-10-21): Python 3.6.8 不兼容 pydantic v2
  - **解决方案**: 使用 conda 创建 Python 3.10.18 虚拟环境
  - **命令**: `conda create -n hive-backend python=3.10 -y`

---

### 1.2 环境检查

#### 🔒 检查项说明

**基础软件版本**:
- [ ] Python 3.10+ 已安装
- [ ] Node.js 20+ 已安装
- [ ] Docker 已安装并运行

**项目依赖**:
- [ ] `backend/.env` 文件存在
- [ ] `frontend/.env` 文件存在
- [ ] 后端 Python 依赖已安装
- [ ] 前端 npm 依赖已安装

#### ✏️ 本次测试填写

```
Python 版本：_____________________
Node 版本：_____________________
Docker 版本：_____________________
后端依赖安装方式：_______________ (pip/conda/poetry)
前端依赖安装方式：_______________ (npm/yarn/pnpm)
```

#### ✅ 最新测试结果

**测试日期**: 2025-10-21
**测试结果**: ✓ 通过

**环境信息**:
- Python: 3.10.18 (conda 虚拟环境 `hive-backend`)
- Node: 20.17.0
- Docker: 26.1.4
- 后端依赖: pip 安装完成
  - FastAPI 0.119.1
  - Uvicorn 0.38.0
  - Pydantic 2.12.3
  - SQLAlchemy 2.0.44
- 前端依赖: npm 安装完成

#### ⚠️ 问题历史

- ✅ **已解决** (2025-10-21): Kerberos 相关包编译失败
  - **详情**: gssapi, krb5 包需要 pg_config，系统缺少依赖
  - **解决方案**: 跳过 Kerberos 包安装（CDP-14 使用 LDAP 认证，不影响功能）
  - **状态**: 可接受，已验证功能正常

---

### 1.3 服务启动验证

#### 🔒 检查项说明

- [ ] **后端服务启动成功**
  - 运行在 `http://localhost:8000`
  - 无启动错误

- [ ] **前端服务启动成功**
  - 运行在 `http://localhost:5173`
  - 无编译错误

- [ ] **服务健康检查通过**
  - `GET /health` 返回 200
  - `GET /` 返回平台信息

#### ✏️ 本次测试填写

```
后端启动命令：_____________________
前端启动命令：_____________________
后端进程 PID：_____________________
前端进程 PID：_____________________
```

#### ✅ 最新测试结果

**测试日期**: 2025-10-21
**测试结果**: ✓ 通过

**服务信息**:
- 后端: `uvicorn app.main:app --host localhost --port 8000`
  - PID: 26375
  - 状态: 运行中
  - 健康检查: ✓ 通过

- 前端: `npm run dev`
  - PID: 27097
  - 状态: 运行中
  - 页面访问: ✓ 正常

**验证命令**:
```bash
$ curl http://localhost:8000/health
{"status": "healthy", "server_config": {...}}

$ curl http://localhost:8000/
{"message": "Hive Small File Management Platform API"}

$ curl http://localhost:8000/api/v1/clusters/
[{"id":1,"name":"production-cluster",...}, ...]
```

#### ⚠️ 问题历史

- 无

---

## 二、后端 API 基础验证

### 2.1 健康检查接口

#### 🔒 检查项说明

- [ ] `GET /health` 返回 `status=healthy`
- [ ] 响应包含 `server_config` 字段
- [ ] 响应时间 < 1s

#### ✏️ 本次测试填写

```
测试命令：_____________________
响应时间：_____________________
```

#### ✅ 最新测试结果

**测试日期**: 2025-10-21
**测试结果**: ✓ 通过

**测试详情**:
```bash
$ curl http://localhost:8000/health
{
  "status": "healthy",
  "server_config": {
    "environment": "development",
    "host": "localhost",
    "port": 8000
  }
}
响应时间: < 100ms
```

#### ⚠️ 问题历史

- 无

---

### 2.2 API 文档访问

#### 🔒 检查项说明

- [ ] `GET /docs` Swagger UI 可访问
- [ ] `GET /redoc` ReDoc 可访问
- [ ] API 接口分组清晰

#### ✏️ 本次测试填写

```
Swagger UI 地址：_____________________
ReDoc 地址：_____________________
API 接口数量：_____________________
```

#### ✅ 最新测试结果

**测试日期**: 2025-10-21
**测试结果**: ✓ 通过

**测试详情**:
- Swagger UI: http://localhost:8000/docs ✓ 可访问
- ReDoc: http://localhost:8000/redoc ✓ 可访问
- API 分组包括: 集群管理、表管理、扫描任务、归档任务、存储管理等

#### ⚠️ 问题历史

- 无

---

## 三、集群管理 API

### 3.1 集群列表查询

#### 🔒 检查项说明

- [ ] `GET /api/v1/clusters/` 返回集群列表
- [ ] 响应包含必要字段: id, name, hive_host, hdfs_namenode_url
- [ ] 分页参数生效 (skip, limit)

#### ✏️ 本次测试填写

```
测试命令：_____________________
返回集群数量：_____________________
分页参数：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 3.2 单个集群查询

#### 🔒 检查项说明

- [ ] `GET /api/v1/clusters/{id}` 返回集群详情
- [ ] 包含完整配置: 认证信息、连接参数
- [ ] 不存在的 ID 返回 404

#### ✏️ 本次测试填写

```
测试集群 ID：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 3.3 集群连接测试

#### 🔒 检查项说明

- [ ] `POST /api/v1/clusters/{id}/test-connection` 测试连接
- [ ] 返回 HiveServer2 连接状态
- [ ] 返回 HDFS 连接状态
- [ ] 返回 Hive Metastore 连接状态

#### ✏️ 本次测试填写

```
测试集群 ID：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 3.4 集群创建

#### 🔒 检查项说明

- [ ] `POST /api/v1/clusters/` 创建集群
- [ ] 必填字段验证
- [ ] 重复名称拒绝
- [ ] 创建成功返回完整信息

#### ✏️ 本次测试填写

```
测试数据：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 3.5 集群更新

#### 🔒 检查项说明

- [ ] `PUT /api/v1/clusters/{id}` 更新集群
- [ ] 部分字段更新
- [ ] 更新后连接测试
- [ ] 不存在的 ID 返回 404

#### ✏️ 本次测试填写

```
测试集群 ID：_____________________
更新字段：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 3.6 集群删除

#### 🔒 检查项说明

- [ ] `DELETE /api/v1/clusters/{id}` 删除集群
- [ ] 有关联表时拒绝删除（或级联删除）
- [ ] 删除成功返回 204
- [ ] 不存在的 ID 返回 404

#### ✏️ 本次测试填写

```
测试集群 ID：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

## 四、表与扫描功能

### 4.1 表列表查询

#### 🔒 检查项说明

- [ ] `GET /api/v1/tables/` 返回表列表
- [ ] 支持按集群过滤
- [ ] 支持分页
- [ ] 返回小文件统计信息

#### ✏️ 本次测试填写

```
测试命令：_____________________
过滤条件：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 4.2 单表详情查询

#### 🔒 检查项说明

- [ ] `GET /api/v1/tables/{id}` 返回表详情
- [ ] 包含分区信息
- [ ] 包含小文件统计
- [ ] 包含最近扫描记录

#### ✏️ 本次测试填写

```
测试表 ID：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 4.3 表扫描任务创建

#### 🔒 检查项说明

- [ ] `POST /api/v1/tables/{id}/scan` 创建扫描任务
- [ ] 返回任务 ID
- [ ] 任务状态为 pending 或 running
- [ ] WebSocket 推送任务状态

#### ✏️ 本次测试填写

```
测试表 ID：_____________________
测试命令：_____________________
任务 ID：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 4.4 扫描任务状态查询

#### 🔒 检查项说明

- [ ] `GET /api/v1/tasks/{task_id}` 查询任务状态
- [ ] 返回进度百分比
- [ ] 返回扫描结果
- [ ] 失败时返回错误信息

#### ✏️ 本次测试填写

```
测试任务 ID：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

## 五、冷数据与表归档

### 5.1 冷数据识别

#### 🔒 检查项说明

- [ ] `GET /api/v1/tables/{id}/cold-data` 识别冷数据
- [ ] 按时间阈值过滤（30/60/90天）
- [ ] 返回冷分区列表
- [ ] 返回可节省空间估算

#### ✏️ 本次测试填写

```
测试表 ID：_____________________
时间阈值：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 5.2 归档任务创建

#### 🔒 检查项说明

- [ ] `POST /api/v1/tables/{id}/archive` 创建归档任务
- [ ] 支持分区级归档
- [ ] 支持表级归档
- [ ] 返回任务 ID

#### ✏️ 本次测试填写

```
测试表 ID：_____________________
归档类型：_____________________ (partition/table)
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 5.3 归档任务执行

#### 🔒 检查项说明

- [ ] 归档任务正常执行
- [ ] 小文件合并为大文件
- [ ] 原文件标记为待删除
- [ ] WebSocket 推送进度
- [ ] 任务完成后状态更新

#### ✏️ 本次测试填写

```
测试任务 ID：_____________________
监控方式：_____________________ (API轮询/WebSocket)
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

## 六、存储管理

### 6.1 存储统计查询

#### 🔒 检查项说明

- [ ] `GET /api/v1/storage/stats` 返回存储统计
- [ ] 按集群分组
- [ ] 包含总空间、已用空间
- [ ] 包含小文件占用统计

#### ✏️ 本次测试填写

```
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 6.2 存储趋势分析

#### 🔒 检查项说明

- [ ] `GET /api/v1/storage/trends` 返回趋势数据
- [ ] 支持时间范围过滤
- [ ] 返回每日统计
- [ ] 图表数据格式正确

#### ✏️ 本次测试填写

```
测试命令：_____________________
时间范围：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

## 七、任务中心

### 7.1 任务列表查询

#### 🔒 检查项说明

- [ ] `GET /api/v1/tasks/` 返回任务列表
- [ ] 支持按状态过滤
- [ ] 支持按类型过滤
- [ ] 支持分页

#### ✏️ 本次测试填写

```
测试命令：_____________________
过滤条件：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 7.2 任务日志查询

#### 🔒 检查项说明

- [ ] `GET /api/v1/tasks/{id}/logs` 返回任务日志
- [ ] 实时更新（长轮询或 WebSocket）
- [ ] 支持日志级别过滤
- [ ] 支持关键词搜索

#### ✏️ 本次测试填写

```
测试任务 ID：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 7.3 任务取消

#### 🔒 检查项说明

- [ ] `POST /api/v1/tasks/{id}/cancel` 取消任务
- [ ] 运行中任务可以取消
- [ ] 已完成任务拒绝取消
- [ ] 取消后资源清理

#### ✏️ 本次测试填写

```
测试任务 ID：_____________________
测试命令：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

## 八、WebSocket 实时推送

### 8.1 WebSocket 连接建立

#### 🔒 检查项说明

- [ ] `WS /ws/tasks/{task_id}` 连接成功
- [ ] 握手成功
- [ ] 心跳机制正常

#### ✏️ 本次测试填写

```
WebSocket 地址：_____________________
测试工具：_____________________ (websocat/浏览器Console)
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 8.2 任务进度推送

#### 🔒 检查项说明

- [ ] 任务开始时推送状态
- [ ] 进度更新实时推送
- [ ] 任务完成时推送结果
- [ ] 任务失败时推送错误

#### ✏️ 本次测试填写

```
测试任务 ID：_____________________
接收到的消息数：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

## 九、前端关键路径

### 9.1 前端首页访问

#### 🔒 检查项说明

- [ ] `http://localhost:5173/` 页面加载
- [ ] 无 JS 错误
- [ ] 布局正常
- [ ] Logo 和标题显示

#### ✏️ 本次测试填写

```
浏览器：_____________________
访问时间：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 9.2 集群管理页面

#### 🔒 检查项说明

- [ ] 集群列表显示
- [ ] 连接测试按钮可用
- [ ] 创建集群表单
- [ ] 编辑/删除功能

#### ✏️ 本次测试填写

```
测试操作：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 9.3 表列表与扫描

#### 🔒 检查项说明

- [ ] 表列表显示
- [ ] 小文件统计正确
- [ ] 扫描按钮触发任务
- [ ] 扫描进度实时更新

#### ✏️ 本次测试填写

```
测试表：_____________________
扫描任务 ID：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 9.4 任务中心页面

#### 🔒 检查项说明

- [ ] 任务列表显示
- [ ] 任务状态更新
- [ ] 日志查看功能
- [ ] 任务取消功能

#### ✏️ 本次测试填写

```
测试任务数量：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

## 十、通过标准与记录

### 10.1 必须通过项

#### 🔒 检查项说明

以下测试项必须全部通过，否则视为测试失败：

- [ ] 环境搭建成功
- [ ] 服务启动无错误
- [ ] 健康检查接口正常
- [ ] 集群连接测试成功
- [ ] 表扫描功能正常
- [ ] 归档任务可以创建和执行
- [ ] 前端页面无严重错误

#### ✏️ 本次测试填写

```
必须项通过数：_____ / 7
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: ⏳ 待测试

#### ⚠️ 问题历史

- 无

---

### 10.2 已知问题记录

#### 🔒 检查项说明

记录测试中发现的所有问题，包括：
- 阻塞性问题（必须修复）
- 非阻塞性问题（可以延后）
- 改进建议

#### ✏️ 本次测试填写

```
发现问题数量：_____________________
阻塞性问题：_____________________
非阻塞性问题：_____________________
```

#### ✅ 最新测试结果

**测试日期**: _____
**测试结果**: _____

#### ⚠️ 问题历史

- 无

---

## 📊 整体测试汇总

### 最新测试汇总 (2025-10-21)

**测试概况**:
- 测试日期: 2025-10-21
- 测试人员: Claude AI Assistant
- 测试环境: 预生产 (CDP-14)
- 完成进度: 5/31 测试项 (16%)

**测试结果统计**:

| 部分 | 总测试项 | 已测试 | 通过 | 失败 | 待测 |
|------|---------|-------|------|------|------|
| 一、环境与前置条件 | 3 | 3 | 3 | 0 | 0 |
| 二、后端API基础验证 | 2 | 2 | 2 | 0 | 0 |
| 三、集群管理API | 6 | 0 | 0 | 0 | 6 |
| 四、表与扫描功能 | 4 | 0 | 0 | 0 | 4 |
| 五、冷数据与表归档 | 3 | 0 | 0 | 0 | 3 |
| 六、存储管理 | 2 | 0 | 0 | 0 | 2 |
| 七、任务中心 | 3 | 0 | 0 | 0 | 3 |
| 八、WebSocket推送 | 2 | 0 | 0 | 0 | 2 |
| 九、前端关键路径 | 4 | 0 | 0 | 0 | 4 |
| 十、通过标准 | 2 | 0 | 0 | 0 | 2 |
| **总计** | **31** | **5** | **5** | **0** | **26** |

**通过率**: 100% (已测试项)
**覆盖率**: 16.1% (已测试/总测试项)

### 遗留问题汇总

**阻塞性问题**: 无

**非阻塞性问题**: 无

**改进建议**:
1. 建议在 README.md 中明确说明最低 Python 版本要求（3.10+）
2. 建议提供 conda environment.yml 文件，便于快速创建环境
3. 建议在 requirements.txt 中添加注释，说明 Kerberos 相关包是可选依赖

---

## 📖 附录：常用命令参考

### 环境管理

```bash
# 创建 conda 环境
conda create -n hive-backend python=3.10 -y
conda activate hive-backend

# 安装依赖
cd backend && pip install -r requirements.txt
cd frontend && npm install

# 启动服务
cd backend && uvicorn app.main:app --reload
cd frontend && npm run dev
```

### API 测试

```bash
# 健康检查
curl http://localhost:8000/health

# 集群列表
curl http://localhost:8000/api/v1/clusters/

# 集群详情
curl http://localhost:8000/api/v1/clusters/3

# 连接测试
curl -X POST http://localhost:8000/api/v1/clusters/3/test-connection

# 表列表
curl "http://localhost:8000/api/v1/tables/?cluster_id=3"

# 创建扫描任务
curl -X POST http://localhost:8000/api/v1/tables/1/scan
```

### WebSocket 测试

```bash
# 使用 websocat 测试
websocat ws://localhost:8000/ws/tasks/1

# 浏览器 Console 测试
const ws = new WebSocket('ws://localhost:8000/ws/tasks/1');
ws.onmessage = (event) => console.log(event.data);
```

### 数据库查询

```bash
# 查看集群配置
sqlite3 backend/var/data/hive_small_file_db.db \
  "SELECT id, name, hive_host, auth_type FROM clusters;"

# 查看表列表
sqlite3 backend/var/data/hive_small_file_db.db \
  "SELECT id, db_name, table_name, cluster_id FROM tables LIMIT 10;"

# 查看任务状态
sqlite3 backend/var/data/hive_small_file_db.db \
  "SELECT id, task_type, status, created_at FROM tasks ORDER BY created_at DESC LIMIT 10;"
```

---

**文档维护**:
- 修改 🔒 检查项说明需要团队审核
- 修改其他区域（✏️ ✅ ⚠️）可随时进行
- 每次测试后记得更新"整体测试汇总"部分
- 定期归档旧的测试结果

**最后更新**: 2025-10-21
**下次计划测试日期**: _____
